<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MP4ã‚¯ãƒªãƒƒãƒ‘ãƒ¼ â€” ãƒ†ãƒ³ãƒ—ãƒ¬ä¸€è‡´ã§è‡ªå‹•åˆ‡ã‚Šå‡ºã—ï¼ˆè©¦ä½œï¼‰</title>
  <meta name="description" content="PyQt5 + OpenCVã§ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒä¸€è‡´ã‚’æ¤œå‡ºã—ã€MP4ã‹ã‚‰åŒºé–“ã‚’è‡ªå‹•ã§ã‚¯ãƒªãƒƒãƒ—åŒ–ã™ã‚‹è©¦ä½œãƒ„ãƒ¼ãƒ«ã®ç´¹ä»‹ãƒšãƒ¼ã‚¸ã€‚" />
  <link rel="stylesheet" href="cliper.css" />
</head>

<body>
  <header class="hero">
    <div class="container hero__inner">
      <div class="badge">Prototype</div>
      <h1>MP4ã‚¯ãƒªãƒƒãƒ‘ãƒ¼</h1>
      <p class="lead">
        PyQt5 + OpenCVã§ã€<strong>ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒãŒæ˜ ã£ãŸç¬é–“</strong>ã‚’æ¤œå‡ºã—<br />
        MP4å‹•ç”»ã‹ã‚‰è‡ªå‹•ã§ã‚¯ãƒªãƒƒãƒ—ã‚’æ›¸ãå‡ºã™è©¦ä½œãƒ„ãƒ¼ãƒ«ã€‚
      </p>

      <div class="hero__cta">
        <a class="btn btn--primary" href="#features">æ©Ÿèƒ½ã‚’è¦‹ã‚‹</a>
        <a class="btn btn--ghost" href="#limits">ã†ã¾ãã„ã‹ãªã‹ã£ãŸç‚¹</a>
        <a class="btn btn--ghost" href="#source">ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰</a>
      </div>

      <div class="hero__meta">
        <div class="metaCard">
          <div class="metaCard__label">UI</div>
          <div class="metaCard__value">PyQt5</div>
        </div>
        <div class="metaCard">
          <div class="metaCard__label">æ¤œå‡º</div>
          <div class="metaCard__value">cv2.matchTemplate</div>
        </div>
        <div class="metaCard">
          <div class="metaCard__label">å‡ºåŠ›</div>
          <div class="metaCard__value">clips/*.mp4</div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="overview" class="section">
      <h2>æ¦‚è¦</h2>
      <p>
        ä»»æ„ã®MP4å‹•ç”»ã«å¯¾ã—ã¦ã€ç‰¹å®šã®UIãƒ»ã‚¢ã‚¤ã‚³ãƒ³ãƒ»é€šçŸ¥ãªã©ã®ã€Œè¦‹ãŸç›®ã€ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒã¨ã—ã¦æŒ‡å®šã—ã€
        å‹•ç”»å†…ã§ä¸€è‡´åº¦ãŒé–¾å€¤ã‚’è¶…ãˆãŸãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é›†ã‚ã¦ã€é€£ç¶šã—ãŸåŒºé–“ã‚’<strong>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ</strong>ã¨ã—ã¦ã¾ã¨ã‚ã¾ã™ã€‚
        ãã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’ã€<strong>å€‹åˆ¥ã®mp4</strong>ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¦ä¿å­˜ã—ã¾ã™ã€‚
      </p>

      <div class="callout">
        <div class="callout__icon">ğŸ§ª</div>
        <div class="callout__body">
          <p class="callout__title">ã“ã‚Œã¯è©¦ä½œãƒ„ãƒ¼ãƒ«ã§ã™</p>
          <p class="callout__text">
            å‹•ä½œã¯ç¢ºèªã§ããŸã‚‚ã®ã®ã€ç‹™ã„é€šã‚Šã«å®‰å®šé‹ç”¨ã™ã‚‹ã«ã¯èª²é¡ŒãŒæ®‹ã‚Šã¾ã—ãŸï¼ˆè©³ç´°ã¯å¾Œè¿°ï¼‰ã€‚
          </p>
        </div>
      </div>
    </section>

    <section id="figures" class="section">
  <h2>å›³ãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ</h2>
  <p class="note">
    â€» ã“ã“ã«ç”»åƒã‚’å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼ˆä¾‹ï¼šGUIç”»é¢ã€ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒã€æ¤œå‡ºã®æµã‚Œã€å‡ºåŠ›çµæœï¼‰ã€‚
    ç”»åƒã¯ <code>images/</code> ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ãæƒ³å®šã§ã™ã€‚
  </p>

  <div class="figureGrid">
    <!-- â‘  ã‚¢ãƒ—ãƒªUI -->
    <figure class="figureCard">
      <div class="figureMedia">
        <img src="images/ui.png" alt="MP4ã‚¯ãƒªãƒƒãƒ‘ãƒ¼ã®GUIç”»é¢ï¼ˆä¾‹ï¼‰" loading="lazy">
      </div>
      <figcaption class="figureCaption">
        <div class="figureTitle">GUIç”»é¢ï¼ˆä¾‹ï¼‰</div>
        <div class="figureText">å‹•ç”»ãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬é¸æŠã€é–¾å€¤ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã€é€²æ—è¡¨ç¤ºã€‚</div>
      </figcaption>
    </figure>

    <!-- â‘¡ ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒ -->
    <figure class="figureCard">
      <div class="figureMedia">
        <img src="images/template.png" alt="ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒï¼ˆä¾‹ï¼‰" loading="lazy">
      </div>
      <figcaption class="figureCaption">
        <div class="figureTitle">ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒï¼ˆä¾‹ï¼‰</div>
        <div class="figureText">æ¤œå‡ºã—ãŸã„UIã‚’åˆ‡ã‚ŠæŠœã„ãŸãƒ†ãƒ³ãƒ—ãƒ¬ã€‚é–¾å€¤ã«å¼·ãå½±éŸ¿ã€‚</div>
      </figcaption>
    </figure>

    <!-- â‘¢ æ¤œå‡ºãƒ•ãƒ­ãƒ¼å›³ï¼ˆè‡ªä½œã§ã‚‚OKï¼‰ -->
    <figure class="figureCard">
      <div class="figureMedia">
        <img src="images/flow.png" alt="å‡¦ç†ã®æµã‚Œï¼ˆä¾‹ï¼‰" loading="lazy">
      </div>
      <figcaption class="figureCaption">
        <div class="figureTitle">å‡¦ç†ã®æµã‚Œï¼ˆä¾‹ï¼‰</div>
        <div class="figureText">ãƒ•ãƒ¬ãƒ¼ãƒ èµ°æŸ» â†’ ä¸€è‡´åˆ¤å®š â†’ é€£ç¶šåŒºé–“åŒ– â†’ MP4æ›¸ãå‡ºã—ã€‚</div>
      </figcaption>
    </figure>

    <!-- â‘£ å‡ºåŠ›çµæœ -->
    <figure class="figureCard">
      <div class="figureMedia">
        <img src="images/output.png" alt="å‡ºåŠ›ã•ã‚ŒãŸclipsãƒ•ã‚©ãƒ«ãƒ€ï¼ˆä¾‹ï¼‰" loading="lazy">
      </div>
      <figcaption class="figureCaption">
        <div class="figureTitle">å‡ºåŠ›çµæœï¼ˆä¾‹ï¼‰</div>
        <div class="figureText">æ¤œå‡ºã•ã‚ŒãŸåŒºé–“ãŒ clips/ ã« clip_1.mp4 å½¢å¼ã§ä¿å­˜ã€‚</div>
      </figcaption>
    </figure>
  </div>
</section>


    <section id="features" class="section">
      <h2>ã§ãã‚‹ã“ã¨</h2>

      <div class="grid">
        <article class="card">
          <h3>å‹•ç”»ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒã‚’é¸ã¶</h3>
          <p>MP4å‹•ç”»ã¨ã€PNG/JPGã®ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒã‚’GUIã‹ã‚‰é¸æŠã—ã¾ã™ã€‚</p>
          <ul class="list">
            <li>å‹•ç”»ï¼š*.mp4</li>
            <li>ãƒ†ãƒ³ãƒ—ãƒ¬ï¼š*.png / *.jpg / *.jpeg</li>
          </ul>
        </article>

        <article class="card">
          <h3>é–¾å€¤ï¼ˆthresholdï¼‰ã‚’èª¿æ•´</h3>
          <p>
            ä¸€è‡´åˆ¤å®šã®é–¾å€¤ã‚’ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§èª¿æ•´ï¼ˆ0.00ã€œ1.00ï¼‰ã€‚
            å€¤ãŒé«˜ã„ã»ã©å³ã—ã‚åˆ¤å®šã€ä½ã„ã»ã©æ‹¾ã„ã‚„ã™ã„åˆ¤å®šã«ãªã‚Šã¾ã™ã€‚
          </p>
        </article>

        <article class="card">
          <h3>ä¸€è‡´åŒºé–“ã‚’æ¤œå‡ºã—ã¦åˆ‡ã‚Šå‡ºã—</h3>
          <p>
            ä¸€è‡´ã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é€£çµã—ã¦ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒ–ã—ã€clips/ã«é€£ç•ªã§ä¿å­˜ã—ã¾ã™ã€‚
          </p>
          <div class="code">
            clips/clip_1.mp4<br />
            clips/clip_2.mp4<br />
            ...
          </div>
        </article>

        <article class="card">
          <h3>é€²æ—è¡¨ç¤ºï¼ˆæ”¹è‰¯ç‰ˆï¼‰</h3>
          <p>
            main2.pyã§ã¯QThreadã‚’ä½¿ã„ã€å‡¦ç†ä¸­ã§ã‚‚UIãŒå›ºã¾ã‚Šã«ãã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
            é€²æ—%ã‚‚ãƒ©ãƒ™ãƒ«ã«åæ˜ ã—ã¾ã™ã€‚
          </p>
        </article>
      </div>
    </section>

    <section id="workflow" class="section">
      <h2>ä½¿ã„æ–¹ï¼ˆã–ã£ãã‚Šï¼‰</h2>
      <ol class="steps">
        <li><span class="stepNum">1</span> MP4å‹•ç”»ã‚’é¸æŠ</li>
        <li><span class="stepNum">2</span> ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒã‚’é¸æŠï¼ˆæ¤œå‡ºã—ãŸã„è¡¨ç¤ºã®åˆ‡ã‚ŠæŠœãï¼‰</li>
        <li><span class="stepNum">3</span> é–¾å€¤ã‚’èª¿æ•´</li>
        <li><span class="stepNum">4</span> å®Ÿè¡Œ â†’ clips/ã«æ›¸ãå‡ºã—</li>
      </ol>
    </section>

    <section id="limits" class="section section--danger">
      <h2>ã†ã¾ãã„ã‹ãªã‹ã£ãŸã“ã¨ï¼ˆé‡è¦ï¼‰</h2>

      <div class="dangerBox">
        <h3>ç‹™ã„é€šã‚Šã«æŠ½å‡ºã§ããªã‹ã£ãŸ & ã¨ã«ã‹ãé…ã‹ã£ãŸ</h3>
        <p>
          ã“ã®è©¦ä½œã§å³ã—ã‹ã£ãŸç‚¹ã¯ã€ä¸»ã«æ¬¡ã®2ã¤ã§ã™ã€‚
        </p>

        <div class="dangerGrid">
          <div class="dangerItem">
            <div class="dangerItem__title">é–¾å€¤èª¿æ•´ã‚’æ‰‹å‹•ã§ã‚„ã‚‹å¿…è¦ãŒã‚ã‚‹</div>
            <div class="dangerItem__text">
              ãƒ†ãƒ³ãƒ—ãƒ¬ä¸€è‡´ã¯<strong>thresholdï¼ˆé–¾å€¤ï¼‰</strong>ã«å¼·ãä¾å­˜ã—ã€
              ã“ã¡ã‚‰ãŒæ¯å›ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§è©¦è¡ŒéŒ¯èª¤ã—ãªã„ã¨ã„ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚
              ãã®çµæœã€ç‹™ã£ã¦ã„ãŸç”»åƒï¼ˆå ´é¢ï¼‰ã‚’<strong>å®‰å®šã—ã¦æŠ½å‡ºã§ããªã„</strong>ã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚
            </div>
          </div>

          <div class="dangerItem">
            <div class="dangerItem__title">å‡¦ç†é€Ÿåº¦ãŒã‚ã¡ã‚ƒãã¡ã‚ƒé…ã„</div>
            <div class="dangerItem__text">
              å…¨ãƒ•ãƒ¬ãƒ¼ãƒ ã§ç…§åˆå‡¦ç†ã‚’å›ã™ãŸã‚ã€å‹•ç”»ãŒé•·ããªã‚‹ã»ã©é‡ããªã‚Šã€
              ä½“æ„Ÿã§ã‚‚ã€Œå¾…ã¡æ™‚é–“ãŒé•·ã™ãã‚‹ã€çŠ¶æ…‹ã«ãªã‚Šã¾ã—ãŸã€‚
            </div>
          </div>
        </div>

        <p class="fineprint">
          ã¾ã¨ã‚ã‚‹ã¨ã€ã€Œå‹•ãã€ã‘ã‚Œã©ã€Œç‹™ã„é€šã‚Šã«ã€é€Ÿãã€ãƒ©ã‚¯ã«ã€ã¯é”æˆã§ããªã‹ã£ãŸã€ã¨ã„ã†çµæœã§ã™ã€‚
        </p>
      </div>
    </section>

    <section id="source" class="section">
      <h2>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰</h2>
      <p class="note">
        é•·ã„ã®ã§ã€æŠ˜ã‚ŠãŸãŸã¿ï¼ˆé–‹é–‰ï¼‰å½¢å¼ã§æ²è¼‰ã—ã¾ã™ã€‚
      </p>

      <details class="details">
        <summary><span class="details__title">main.pyï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰</span><span class="details__meta">ã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰</span></summary>
        <pre class="pre"><code class="language-python">import sys
from PyQt5.QtWidgets import(
    QApplication, QWidget, QVBoxLayout, QPushButton, QLabel, QFileDialog, QSlider, QLineEdit
)
from PyQt5.QtCore import Qt
from matcher import find_matching_segments, export_clips

class App(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle('MP4ã‚¯ãƒªãƒƒãƒ‘ãƒ¼')
        self.setGeometry(100, 100, 400, 300)

        # åˆæœŸå€¤
        self.video_path = None
        self.template_path = None
        self.threshold = 0.8

        self.init_ui()

    def init_ui(self):
        layout = QVBoxLayout()

        # å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ©ãƒ™ãƒ«ã¨ãƒœã‚¿ãƒ³
        self.video_label = QLabel('å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ï¼šæœªé¸æŠ')
        self.video_btn = QPushButton('å‹•ç”»ã‚’é¸æŠ')
        self.video_btn.clicked.connect(self.select_video)

        # ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒã®ãƒ©ãƒ™ãƒ«ãƒ»ãƒœã‚¿ãƒ³
        self.template_label = QLabel('ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒï¼šæœªé¸æŠ')
        self.template_btn = QPushButton('ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒã‚’é¸æŠ')
        self.template_btn.clicked.connect(self.select_template)

        # é–¾å€¤ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
        self.threshold_label = QLabel('é–¾å€¤')
        self.threshold_input = QLineEdit('0.8')
        self.threshold_input.setReadOnly(True)

        self.threshold_slider = QSlider(Qt.Horizontal)
        self.threshold_slider.setMinimum(0)
        self.threshold_slider.setMaximum(100)
        self.threshold_slider.setValue(int(self.threshold * 100))
        self.threshold_slider.valueChanged.connect(self.update_threshold)

        # å®Ÿè¡Œãƒœã‚¿ãƒ³
        self.run_btn = QPushButton('å®Ÿè¡Œ')
        self.run_btn.clicked.connect(self.run_detection)

        # é€²æ—%
        self.progress_label = QLabel("é€²è¡ŒçŠ¶æ³: 0%")
        layout.addWidget(self.progress_label)

        layout.addWidget(self.video_label)
        layout.addWidget(self.video_btn)
        layout.addWidget(self.template_label)
        layout.addWidget(self.template_btn)
        layout.addWidget(self.threshold_label)
        layout.addWidget(self.threshold_input)
        layout.addWidget(self.threshold_slider)
        layout.addWidget(self.run_btn)

        self.setLayout(layout)

    def select_video(self):
        file, _ = QFileDialog.getOpenFileName(self, 'å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ', '', 'MP4 files (*.mp4);;ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ« (*.*)')
        if file:
            self.video_path = file
            self.video_label.setText(f"å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«: {file}")

    def select_template(self):
        file, _ = QFileDialog.getOpenFileName(self, 'ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒ', '', 'ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« (*.png *.jpg *.jpeg);;ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ« (*.*)')
        if file:
            self.template_path = file
            self.template_label.setText(f"ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒ: {file}")

    def run_detection(self):
        if not self.video_path:
            print('error: å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸ã°ã‚Œã¦ã„ã¾ã›ã‚“')
            return
        elif not self.template_path:
            print('error: ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒãŒé¸ã°ã‚Œã¦ã„ã¾ã›ã‚“')
            return
        else:
            print(f"done: å‹•ç”»: {self.video_path}")
            print(f"done: ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒ: {self.template_path}")
            print("æ˜ åƒè§£æã‚’å§‹ã‚ã¾ã™...")
            segments = find_matching_segments(
                self.video_path,
                self.template_path,
                threshold=self.threshold,
                min_length=10,
                progress_callback=self.update_progress
            )
            if not segments:
                print("âš ï¸ ä¸€è‡´ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
                return

            print(f"ğŸ {len(segments)} å€‹ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚ä¿å­˜å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...")

            export_clips(
                self.video_path,
                segments,
                output_dir="clips"
            )

            print("âœ… ã™ã¹ã¦ã®ã‚¯ãƒªãƒƒãƒ—ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼clips/ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
            self.update_progress(100.0)

    def update_threshold(self, value):
        self.threshold = value / 100.0
        self.threshold_input.setText(f"{self.threshold:.2f}")

    def update_progress(self, percent):
        self.progress_label.setText(f"é€²è¡ŒçŠ¶æ³: {percent:.1f}%")

if __name__ == '__main__':
    app = QApplication(sys.argv)
    win = App()
    win.show()
    sys.exit(app.exec_())</code></pre>
      </details>

      <details class="details">
        <summary><span class="details__title">main2.pyï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ç‰ˆï¼‰</span><span class="details__meta">ã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰</span></summary>
        <pre class="pre"><code class="language-python">import sys
from PyQt5.QtWidgets import (
    QApplication, QWidget, QVBoxLayout, QPushButton, QLabel,
    QFileDialog, QSlider, QLineEdit
)
from PyQt5.QtCore import Qt, QThread, pyqtSignal
from matcher import find_matching_segments, export_clips

class WorkerThread(QThread):
    progress = pyqtSignal(float)
    finished = pyqtSignal()
    error = pyqtSignal(str)

    def __init__(self, video_path, template_path, threshold):
        super().__init__()
        self.video_path = video_path
        self.template_path = template_path
        self.threshold = threshold

    def run(self):
        try:
            segments = find_matching_segments(
                self.video_path,
                self.template_path,
                threshold=self.threshold,
                min_length=10,
                progress_callback=self.progress.emit
            )

            if not segments:
                self.error.emit("ä¸€è‡´ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
                return

            export_clips(self.video_path, segments, output_dir="clips")
            self.finished.emit()

        except Exception as e:
            self.error.emit(str(e))

class App(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle('MP4ã‚¯ãƒªãƒƒãƒ‘ãƒ¼')
        self.setGeometry(100, 100, 400, 350)

        self.video_path = None
        self.template_path = None
        self.threshold = 0.8

        self.init_ui()

    def init_ui(self):
        layout = QVBoxLayout()

        self.video_label = QLabel('å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ï¼šæœªé¸æŠ')
        self.video_btn = QPushButton('å‹•ç”»ã‚’é¸æŠ')
        self.video_btn.clicked.connect(self.select_video)

        self.template_label = QLabel('ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒï¼šæœªé¸æŠ')
        self.template_btn = QPushButton('ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒã‚’é¸æŠ')
        self.template_btn.clicked.connect(self.select_template)

        self.threshold_label = QLabel('é–¾å€¤')
        self.threshold_input = QLineEdit('0.8')
        self.threshold_input.setReadOnly(True)

        self.threshold_slider = QSlider(Qt.Horizontal)
        self.threshold_slider.setMinimum(0)
        self.threshold_slider.setMaximum(100)
        self.threshold_slider.setValue(int(self.threshold * 100))
        self.threshold_slider.valueChanged.connect(self.update_threshold)

        self.run_btn = QPushButton('å®Ÿè¡Œ')
        self.run_btn.clicked.connect(self.run_detection)

        self.progress_label = QLabel("é€²è¡ŒçŠ¶æ³: 0%")

        layout.addWidget(self.video_label)
        layout.addWidget(self.video_btn)
        layout.addWidget(self.template_label)
        layout.addWidget(self.template_btn)
        layout.addWidget(self.threshold_label)
        layout.addWidget(self.threshold_input)
        layout.addWidget(self.threshold_slider)
        layout.addWidget(self.run_btn)
        layout.addWidget(self.progress_label)

        self.setLayout(layout)

    def select_video(self):
        file, _ = QFileDialog.getOpenFileName(self, 'å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ', '', 'MP4 files (*.mp4);;ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ« (*.*)')
        if file:
            self.video_path = file
            self.video_label.setText(f"å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«: {file}")

    def select_template(self):
        file, _ = QFileDialog.getOpenFileName(self, 'ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒã‚’é¸æŠ', '', 'ç”»åƒãƒ•ã‚¡ã‚¤ãƒ« (*.png *.jpg *.jpeg);;ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ« (*.*)')
        if file:
            self.template_path = file
            self.template_label.setText(f"ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒ: {file}")

    def update_threshold(self, value):
        self.threshold = value / 100.0
        self.threshold_input.setText(f"{self.threshold:.2f}")

    def update_progress(self, percent):
        self.progress_label.setText(f"é€²è¡ŒçŠ¶æ³: {percent:.1f}%")

    def run_detection(self):
        if not self.video_path:
            print('error: å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸ã°ã‚Œã¦ã„ã¾ã›ã‚“')
            return
        if not self.template_path:
            print('error: ãƒ†ãƒ³ãƒ—ãƒ¬ç”»åƒãŒé¸ã°ã‚Œã¦ã„ã¾ã›ã‚“')
            return

        self.progress_label.setText("é€²è¡ŒçŠ¶æ³: 0%")

        self.worker = WorkerThread(
            self.video_path,
            self.template_path,
            self.threshold
        )
        self.worker.progress.connect(self.update_progress)
        self.worker.finished.connect(self.detection_finished)
        self.worker.error.connect(self.detection_error)
        self.worker.start()

    def detection_finished(self):
        self.update_progress(100.0)
        print("âœ… ã™ã¹ã¦ã®ã‚¯ãƒªãƒƒãƒ—ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼clips/ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")

    def detection_error(self, message):
        print(f"âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: {message}")

if __name__ == '__main__':
    app = QApplication(sys.argv)
    win = App()
    win.show()
    sys.exit(app.exec_())</code></pre>
      </details>

      <details class="details">
        <summary><span class="details__title">matcher.pyï¼ˆæ¤œå‡ºãƒ»æ›¸ãå‡ºã—ï¼‰</span><span class="details__meta">ã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰</span></summary>
        <pre class="pre"><code class="language-python">import cv2
import numpy as np
import os

def group_frames(frames, min_length=10):
    if not frames:
        return []

    segments = []
    start = None
    prev = -2

    for idx in frames:
        if idx != prev + 1:
            if start is not None and prev - start + 1 >= min_length:
                segments.append((start, prev))
            start = idx
        prev = idx

    if start is not None and prev - start + 1 >= min_length:
        segments.append((start, prev))

    return segments

def find_matching_segments(video_path, template_path, threshold=0.8, min_length=10, progress_callback=None):
    cap = cv2.VideoCapture(video_path)
    template = cv2.imread(template_path, 0)
    match_frames = []
    total_frames = int(cap.get(cv2.CAP_PROP_FRAME_COUNT))
    frame_idx = 0

    while True:
        ret, frame = cap.read()
        if not ret:
            break

        gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
        res = cv2.matchTemplate(gray, template, cv2.TM_CCOEFF_NORMED)

        if np.max(res) >= threshold:
            match_frames.append(frame_idx)

        if progress_callback and frame_idx % 10 == 0:
            percent = (frame_idx / total_frames) * 100
            progress_callback(percent)

        frame_idx += 1

    cap.release()
    return group_frames(match_frames, min_length)

def export_clips(video_path, segments, output_dir='clips', prefix='clip'):
    cap = cv2.VideoCapture(video_path)

    fps = cap.get(cv2.CAP_PROP_FPS)
    width = int(cap.get(cv2.CAP_PROP_FRAME_WIDTH))
    height = int(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))

    os.makedirs(output_dir, exist_ok=True)

    for i, (start, end) in enumerate(segments):
        cap.set(cv2.CAP_PROP_POS_FRAMES, start)

        out_path = os.path.join(output_dir, f"{prefix}_{i+1}.mp4")
        fourcc = cv2.VideoWriter_fourcc(*'mp4v')
        out = cv2.VideoWriter(out_path, fourcc, fps, (width, height))

        for _ in range(end - start + 1):
            ret, frame = cap.read()
            if not ret:
                break
            out.write(frame)
        out.release()

    cap.release()</code></pre>
      </details>
    </section>

    <footer class="footer">
      <p>Â© Prototype: MP4ã‚¯ãƒªãƒƒãƒ‘ãƒ¼ / PyQt5 + OpenCV</p>
    </footer>
  </main>
</body>
</html>
